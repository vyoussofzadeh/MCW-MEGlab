% Script generated by Brainstorm (19-Aug-2019)

% Input files
sFiles = {...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_02.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_03.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_04.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_05.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_06.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_07.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_08.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_09.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_10.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_100.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_101.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_102.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_103.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_104.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_105.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_106.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_107.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_108.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_109.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_11.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_110.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_111.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_112.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_12.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_13.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_14.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_15.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_16.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_17.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_18.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_19.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_20.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_21.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_22.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_23.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_24.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_25.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_26.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_27.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_28.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_29.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_30.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_31.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_32.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_33.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_34.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_35.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_36.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_37.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_38.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_39.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_40.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_41.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_42.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_43.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_44.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_45.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_46.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_47.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_48.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_49.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_50.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_51.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_52.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_53.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_54.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_55.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_56.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_57.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_58.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_59.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_60.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_61.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_62.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_63.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_64.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_65.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_66.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_67.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_68.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_69.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_70.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_71.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_72.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_73.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_74.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_75.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_76.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_77.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_78.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_79.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_80.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_81.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_82.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_83.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_84.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_85.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_86.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_87.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_88.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_89.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_90.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_91.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_92.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_93.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_94.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_95.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_96.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_97.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_98.mat', ...
    'hulan_eleanor/PN_hulan_eleanor_IC_data/data_PN_hulan_eleanor_IC_99.mat'};

% Start a new report
bst_report('Start', sFiles);

% Process: Compute head model
sFiles = bst_process('CallProcess', 'process_headmodel', sFiles, [], ...
    'Comment',     '', ...
    'sourcespace', 1, ...  % Cortex surface
    'volumegrid',  struct(...
         'Method',        'isotropic', ...
         'nLayers',       17, ...
         'Reduction',     3, ...
         'nVerticesInit', 4000, ...
         'Resolution',    0.005, ...
         'FileName',      ''), ...
    'meg',         3, ...  % Overlapping spheres
    'eeg',         3, ...  % OpenMEEG BEM
    'ecog',        2, ...  % OpenMEEG BEM
    'seeg',        2, ...  % OpenMEEG BEM
    'openmeeg',    struct(...
         'BemFiles',     {{}}, ...
         'BemNames',     {{'Scalp', 'Skull', 'Brain'}}, ...
         'BemCond',      [1, 0.0125, 1], ...
         'BemSelect',    [1, 1, 1], ...
         'isAdjoint',    0, ...
         'isAdaptative', 1, ...
         'isSplit',      0, ...
         'SplitLength',  4000));

% Process: Compute covariance (noise or data)
sFiles = bst_process('CallProcess', 'process_noisecov', sFiles, [], ...
    'baseline',       [-0.3, -0.001], ...
    'datatimewindow', [0, 2], ...
    'sensortypes',    'MEG, EEG, SEEG, ECOG', ...
    'target',         1, ...  % Noise covariance     (covariance over baseline time window)
    'dcoffset',       1, ...  % Block by block, to avoid effects of slow shifts in data
    'identity',       0, ...
    'copycond',       0, ...
    'copysubj',       0, ...
    'copymatch',      0, ...
    'replacefile',    1);  % Replace

% Process: Average: Everything
sFiles = bst_process('CallProcess', 'process_average', sFiles, [], ...
    'avgtype',    1, ...  % Everything
    'avg_func',   1, ...  % Arithmetic average:  mean(x)
    'weighted',   0, ...
    'keepevents', 0);

% Process: Extract time: [-300ms,2000ms]
sFiles = bst_process('CallProcess', 'process_extract_time', sFiles, [], ...
    'timewindow', [-0.3, 2], ...
    'overwrite',  0);

% Process: Compute sources [2009]
sFiles = bst_process('CallProcess', 'process_inverse', sFiles, [], ...
    'Comment',     '', ...
    'method',      2, ...  % dSPM
    'wmne',        struct(...
         'NoiseCov',      [], ...
         'InverseMethod', 'wmne', ...
         'ChannelTypes',  {{}}, ...
         'SNR',           3, ...
         'diagnoise',     0, ...
         'SourceOrient',  {{'fixed'}}, ...
         'loose',         0.2, ...
         'depth',         1, ...
         'weightexp',     0.5, ...
         'weightlimit',   10, ...
         'regnoise',      1, ...
         'magreg',        0.1, ...
         'gradreg',       0.1, ...
         'eegreg',        0.1, ...
         'ecogreg',       0.1, ...
         'seegreg',       0.1, ...
         'fMRI',          [], ...
         'fMRIthresh',    [], ...
         'fMRIoff',       0.1, ...
         'pca',           1), ...
    'sensortypes', 'MEG, MEG MAG, MEG GRAD', ...
    'output',      1);  % Kernel only: shared

% Process: Average time: [400ms,800ms], abs
sFiles = bst_process('CallProcess', 'process_average_time', sFiles, [], ...
    'timewindow', [0.4, 0.8], ...
    'isstd',      0, ...
    'overwrite',  0, ...
    'source_abs', 1);

% Save and display report
ReportFile = bst_report('Save', sFiles);
bst_report('Open', ReportFile);
% bst_report('Export', ReportFile, ExportDir);

